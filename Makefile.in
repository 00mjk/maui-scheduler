# Makefile  @PACKAGE_NAME@ v@PACKAGE_VERSION@
# Copyright:    (C) 2002-2010  Cluster Resources, Inc, All Rights Reserved      
# Copyright:    (C) 2016 Temple HPC Team
#
# Generated by configure

BUILDROOT ?=
DESTDIR ?=${BUILDROOT}
export MSCHED_HOME=${DESTDIR}@SPOOLDIR@
export INST_DIR=${DESTDIR}@prefix@
export DAEMONDEF=@DAEMONDEF@
export OPSYS=@OPSYS@
export OS=@OS@
export CC=@CC@
export OSCCFLAGS=@CFLAGS@
export OSLDFLAGS=@LDFLAGS@

#SECDEC =-D__MMD5 -D__MOPENSSL
#SECLIB =-lcrypto -lssl

# ============================
# Resource Manager section
# ============================
# We only want PBS/Torque support...
@pbs_definitions@
#@ll_definitions@
#@sdr_definitions@
#@sge_definitions@
#@lsf_definitions@
#@mx_definitions@
#@pcre_definitions@

# ============================
# Master Makefile for @PACKAGE_NAME@ v@PACKAGE_VERSION@
# ============================

all: config.status
	${MAKE} -C src/moab all
	${MAKE} -C src/mcom all
	${MAKE} -C src/server all
	${MAKE} -C src/server setup   

dep:
	${MAKE} -C tools fastdep.exe
	${MAKE} -C src/moab dep
	${MAKE} -C src/mcom dep
	${MAKE} -C src/server dep

clean:
	${MAKE} -C tools clean
	${MAKE} -C src/moab clean
	${MAKE} -C src/mcom clean
	${MAKE} -C src/server clean

test:
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST=SCHED ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST=JOBNAME:PBS:34.localhost.localnet:34 ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST=JOBNAME:PBS:23.localhost:23 ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST=JOBDIST ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='RMX:FLAGS:ADVRES:default.0' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='RMX:GRES:gpu@2,matlab' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='RMX:DMEM:512' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='NODEPRIO' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='RANGEMERGE' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='RANGECOLLAPSE' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='RANGEAND' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='FEATURESUB' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='GETSNRANGE' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST='XML:<test><level></level></test>' ./bin/maui -d
	env MAUILOGSTDERR=1 MAUIHOMEDIR=$$PWD MAUITEST=SUBMIT:PBS ./bin/maui -d || :

install:
	${MAKE} -C src/moab install
	${MAKE} -C src/mcom install
	${MAKE} -C src/server install    

uninstall:
	${MAKE} -C src/moab uninstall
	${MAKE} -C src/mcom uninstall
	${MAKE} -C src/server uninstall

doc:
	${MAKE} -C docs guide refman

pdf:	doc
	${MAKE} -C docs pdf

setup:
	${MAKE} -C src/server setup        

distclean: clean
	${MAKE} -C docs clean-all
	rm -f Makefile maui.cfg.dist include/Makefile.inc.*[!i][!n] include/maui.cfg.dist.inc.*[!i][!n]
	rm -f maui.ck maui-private.cfg maui.cfg maui-private.cfg.dist docs/Doxyfile
	rm -f etc/maui.sh etc/maui.csh include/moab-local.h config.log config.status include/msched-version.h

config.status: configure Makefile.in include/moab-local.h.in include/msched-version.h.in \
 include/Makefile.inc.pbs.in maui.cfg.dist.in etc/maui.csh.in etc/maui.sh.in maui-private.cfg.dist.in
	./config.status --recheck
	./config.status
	${MAKE} clean

tar:
	git -c tar.umask=0022 -c tar.tar.gz.command="gzip -9cn" archive --prefix=@PACKAGE_TARNAME@-@PACKAGE_VERSION@/ --format=tar.gz -o ../@PACKAGE_TARNAME@-@PACKAGE_VERSION@.tar.gz HEAD
