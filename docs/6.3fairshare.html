<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6.3. Fairshare &mdash; Maui Scheduler™ Administrator&#39;s Guide 3.2 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Maui Scheduler™ Administrator&#39;s Guide 3.2 documentation" href="index.html" />
    <link rel="up" title="6. Managing Fairness - Throttling Policies, Fairshare, and Allocation Management" href="6.0managingfairness.html" />
    <link rel="next" title="6.4. Allocation Management" href="6.4allocationmanagement.html" />
    <link rel="prev" title="6.2. Throttling Policies" href="6.2throttlingpolicies.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="6.4allocationmanagement.html" title="6.4. Allocation Management"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="6.2throttlingpolicies.html" title="6.2. Throttling Policies"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Maui Scheduler™ Administrator&#39;s Guide 3.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="6.0managingfairness.html" accesskey="U">6. Managing Fairness - Throttling Policies, Fairshare, and Allocation Management</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fairshare">
<h1>6.3. Fairshare<a class="headerlink" href="#fairshare" title="Permalink to this headline">¶</a></h1>
<p>Fairshare is a mechanism which allows historical resource utilization
information to be incorporated into job feasibility and priority
decisions. Maui&#8217;s fairshare implementation allows site administrators to
set system utilization targets for users, groups, accounts, classes, and
QOS levels.</p>
<div class="section" id="overview">
<h2>6.3.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Fairshare allows historical resource utilization information to be
incorporated into job feasibility and priority decisions. This feature
allows site administrators to set system utilization targets for users,
groups, accounts, classes, and QOS levels. Administrators can also
specify the timeframe over which resource utilization is evaluated in
determining whether or not the goal is being reached. Parameters allow
sites to specify the utilization metric, how historical information is
aggregated, and the effect of fairshare state on scheduling behavior.
Fairshare targets can be specified for any credentials (i.e., user,
group, class, etc) which administrators wish to have affected by this
information.</p>
</div>
<div class="section" id="fairshare-parameters">
<h2>6.3.2. Fairshare Parameters<a class="headerlink" href="#fairshare-parameters" title="Permalink to this headline">¶</a></h2>
<p>Fairshare is configured at two levels. First, at a system level,
configuration is required to determine how fairshare usage information
is to be collected and processed. Secondly, some configuration is
required at the credential level to determine how this fairshare
information affects particular jobs. The system level parameters are
listed below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Parameter<a href="#id1"><span class="problematic" id="id2">**</span></a>**
<strong>Description</strong></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="a.fparameters.html#fsinterval">FSINTERVAL</a>
duration of each fairshare window</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="a.fparameters.html#fsdepth">FSDEPTH</a>
number of fairshare windows factored into current fairshare utilization</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="a.fparameters.html#fsdecay">FSDECAY</a>
decay factor applied to weighting the contribution of each fairshare
window</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="a.fparameters.html#fspolicy">FSPOLICY</a>
metric to use when tracking fairshare usage</td>
</tr>
</tbody>
</table>
<p>Credential level configuration consists of specifying fairshare
utilization targets using the <strong>*CFG</strong> suite of parameters, i.e.,
<a class="reference external" href="a.fparameters.html#accountcfg">ACCOUNTCFG</a>,
<a class="reference external" href="a.fparameters.html#classcfg">CLASSCFG</a>,
<a class="reference external" href="a.fparameters.html#groupcfg">GROUPCFG</a>,
<a class="reference external" href="a.fparameters.html#qoscfg">QOSCFG</a>, and
<a class="reference external" href="a.fparameters.html#usercfg">USERCFG</a>.</p>
<div class="section" id="metric-of-consumption">
<h3>6.3.2.1. Metric of Consumption<a class="headerlink" href="#metric-of-consumption" title="Permalink to this headline">¶</a></h3>
<p>As Maui runs, it records how available resources are being utilized.
Each iteration (<strong>RMPOLLINTERVAL</strong> seconds) it updates fairshare
resource utilization statistics. Resource utilization is tracked in
accordance with the <a class="reference external" href="a.fparameters.html#fspolicy">FSPOLICY</a> parameter
allowing various aspects of resource consumption information to be
measured. This parameter allows selection of both the types of resources
to be tracked and the method of tracking. It provides the option of
tracking usage by <em>dedicated</em> or <em>consumed</em> resources, where dedicated
usage tracks what the scheduler assigns to the job and consumed usage
tracks what the job actually uses.</p>
<p>An example may clarify the use of the <strong>FSPOLICY</strong> parameter. Assume a 4
processor job is running a parallel &#8216;/bin/sleep&#8217; for 15 minutes. It will
have a dedicated fairshare usage of 1 proc-hour but a consumed fairshare
usage of essentially nothing since it did not consume anything. Most
often, dedicated fairshare usage is used on dedicated resource platforms
while consumed tracking is used in shared SMP environments.</p>
<p><strong>Percentage Based Fairshare</strong></p>
<p>By default, when comparing fairshare usage against fairshare targets,
Maui will calculate the fairshare component of priority as a difference
between fairshare target and fairshare usage. To change the fairshare
priority component to be calculated as a ratio (1 - fairshare
usage/fairshare target) a &#8216;%&#8217; (percent) character can be specified at
the end of the <strong>FSPOLICY</strong> value.</p>
</div>
<div class="section" id="specifying-fairshare-timeframe">
<h3>6.3.2.2. Specifying Fairshare Timeframe<a class="headerlink" href="#specifying-fairshare-timeframe" title="Permalink to this headline">¶</a></h3>
<p>When configuring fairshare, it is important to determine the proper
timeframe that should be considered. Many sites choose to incorporate
historical usage information from the last one to two weeks while others
are only concerned about the events of the last few hours. The correct
setting is very site dependent and usually incorporates both average job
turnaround time and site mission policies.</p>
<p>With Maui&#8217;s fairshare system, time is broken into a number of distinct
fairshare windows. Sites configure the amount of time they wish to
consider by specifying two parameters,
<a class="reference external" href="a.fparameters.html#fsinterval">FSINTERVAL</a>, and
<a class="reference external" href="a.fparameters.html#fsdepth">FSDEPTH</a>. The <strong>FSINTERVAL</strong> parameter
specifies the duration of each window while the <strong>FSDEPTH</strong> parameter
indicates the number of windows to consider. Thus, the total time
evaluated by fairshare is simply <strong>FSINTERVAL</strong> * <strong>FSDEPTH</strong>.</p>
<p>Many sites want to limit the impact of fairshare data according to its
age. The <a class="reference external" href="a.fparameters.html#fsdecay">FSDECAY</a> parameters allows this
to be done, causing the most recent fairshare data to contribute more to
a credential&#8217;s total fairshare usage than older data. This parameter is
specified as a standard decay factors which is applied to the fairshare
data. Generally, decay factors are specified as a value between 1 and 0
where a value of <strong>1</strong> (the default) indicates no decay should be
specified. The smaller the number, the more rapid the decay using the
calculation <em>WeightedValue = Value * &lt;DECAY&gt; ^ &lt;N&gt;</em> where &lt;N&gt; is the
window number. The table below shows the impact of a number of commonly
used decay factors on the percentage contribution of each fairshare
window.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Decay Factor</strong>
<strong>Window0</strong>
<strong>Window1</strong>
<strong>Window2</strong>
<strong>Window3</strong>
<strong>Window4</strong>
<strong>Window5</strong>
<strong>Window6</strong>
<strong>Window7</strong></td>
</tr>
<tr class="row-even"><td>1.00
100%
100%
100%
100%
100%
100%
100%
100%</td>
</tr>
<tr class="row-odd"><td>0.80
100%
80%
64%
51%
41%
33%
26%
21%</td>
</tr>
<tr class="row-even"><td>0.75
100%
75%
56%
42%
31%
23%
17%
12%</td>
</tr>
<tr class="row-odd"><td>0.50
100%
50%
25%
13%
6%
3%
2%
1%</td>
</tr>
</tbody>
</table>
<p>While selecting how the total fairshare timeframe is broken up between
the number and length of windows is a matter of preference, it is
important to note that more windows will cause the decay factor to
degrade the contribution of aged data more quickly.</p>
</div>
<div class="section" id="managing-fairshare-data">
<h3>6.3.2.3. Managing Fairshare Data<a class="headerlink" href="#managing-fairshare-data" title="Permalink to this headline">¶</a></h3>
<p>Using the selected fairshare usage metric, Maui continues to update the
current fairshare window until it reaches a fairshare window boundary,
at which point it rolls the fairshare window and begins updating the new
window. The information for each window is stored in its own file
located in the Maui statistics directory. Each file is named
&#8216;<code class="docutils literal"><span class="pre">FS.&lt;EPOCHTIME&gt;</span></code>&#8216; where <code class="docutils literal"><span class="pre">&lt;EPOCHTIME&gt;</span></code> is the time the new fairshare
window became active. Each window contains utilization information for
each entity as well as for total usage. A sample fairshare data file is
shown below:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">-----</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">#</span> <span class="pre">Fairshare</span> <span class="pre">Data</span> <span class="pre">File</span> <span class="pre">(Duration:</span> <span class="pre">172800</span> <span class="pre">Seconds)</span> <span class="pre">Starting:</span> <span class="pre">Fri</span> <span class="pre">Aug</span> <span class="pre">18</span> <span class="pre">18:00:00</span></code></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">User</span> <span class="pre">USERA</span> <span class="pre">150000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">User</span> <span class="pre">USERB</span> <span class="pre">150000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">User</span> <span class="pre">USERC</span> <span class="pre">200000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">User</span> <span class="pre">USERD</span> <span class="pre">100000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Group</span> <span class="pre">GROUPA</span> <span class="pre">350000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Group</span> <span class="pre">GROUPB</span> <span class="pre">250000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Account</span> <span class="pre">ACCTA</span> <span class="pre">300000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Account</span> <span class="pre">ACCTB</span> <span class="pre">200000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Account</span> <span class="pre">ACCTC</span> <span class="pre">100000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">QOS</span> <span class="pre">0</span> <span class="pre">50000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">QOS</span> <span class="pre">1</span> <span class="pre">450000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">QOS</span> <span class="pre">2</span> <span class="pre">100000.000</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">TOTAL</span> <span class="pre">600000.00</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">-----</span></code></div>
</div>
<p><a href="#id3"><span class="problematic" id="id4">**</span></a>** Note that the total processor hours consumed in this time interval
is 600,000 processor seconds. Since every job in this example scenario
had a user, group, account, and QOS assigned to it, the sum of the usage
of all members of each category should equal the total usage value
(i.e., USERA + USERB + ... + USERD = GROUPA + GROUPB = ACCTA + ... +
ACCTC = QOS0 + ... + QOS2 = TOTAL)</p>
<p>When Maui needs to determine current fairshare usage for a particular
credential, it calculates a <em>decay-weighted</em> average of the usage
information for that credential using the most recent fairshare
intervals where the number of windows evaluated is controlled by the
<a class="reference external" href="a.fparameters.html#fsdepth">FSDEPTH</a> parameter. For example, if the
credential of interest is user <em>John</em> and the following parameters are
set,</p>
<div class="line-block">
<div class="line"><strong>``FSINTERVAL 12:00:00``</strong></div>
<div class="line"><strong>``FSDEPTH 4``</strong></div>
<div class="line"><strong>``FSDECAY 0.5``</strong></div>
</div>
<p><a href="#id5"><span class="problematic" id="id6">**</span></a>** and the fairshare data files contain the following usage amounts
for the entity of interest:</p>
<div class="line-block">
<div class="line"><strong>``John[0] 60.0``</strong></div>
<div class="line"><strong>``Total[0] 110.0``</strong></div>
</div>
<div class="line-block">
<div class="line"><strong>``John[1] 0.0``</strong></div>
<div class="line"><strong>``Total[1] 125.0``</strong></div>
</div>
<div class="line-block">
<div class="line"><strong>``John[2] 10.0``</strong></div>
<div class="line"><strong>``Total[2] 100.0``</strong></div>
</div>
<div class="line-block">
<div class="line"><strong>``John[3] 50.0``</strong></div>
<div class="line"><strong>``Total[3] 150.0``</strong></div>
</div>
<p><a href="#id7"><span class="problematic" id="id8">**</span></a>** The current fairshare usage for user John would calculated as
follows:</p>
<p><strong>Usage = (60 + .5^1 * 0 + .5^2 * 10 + .5^3 * 50) / (110 + .5^1*125
+ .5^2*100 + .5^3*150)</strong></p>
<p><a href="#id9"><span class="problematic" id="id10">**</span></a>** Note that the current fairshare usage is relative to the actual
resources delivered by the system over the timeframe evaluated, not the
resources available or configured during that time.</p>
<p><a href="#id11"><span class="problematic" id="id12">|image5|</span></a> Historical fairshare data is organized into a number of data
files, each file containing the information for a length of time as
specified by the <a class="reference external" href="a.fparameters.html#fsinterval">FSINTERVAL</a>
parameter. Although <strong>FSDEPTH</strong>, <strong>FSINTERVAL</strong>, and <strong>FSDECAY</strong> can be
freely and dynamically modified, such changes may result in unexpected
fairshare status for a period of time as the fairshare data files with
the old <strong>FSINTERVAL</strong> setting are rolled out.</p>
</div>
</div>
<div class="section" id="using-fairshare-information">
<h2>6.3.3. Using Fairshare Information<a class="headerlink" href="#using-fairshare-information" title="Permalink to this headline">¶</a></h2>
<p>With the mechanism used to determine current fairshare usage explained
above, the next step is using this information to affect scheduling
behavior. As mentioned in the Fairshare Overview, sites have the ability
to configure how fairshare information impacts scheduling behavior. This
is done through specification of the fairshare targets. These targets
allow fairshare information to either affect job feasibility or job
priority.</p>
<div class="section" id="priority-based-fairshare">
<h3>6.3.3.1. Priority Based Fairshare<a class="headerlink" href="#priority-based-fairshare" title="Permalink to this headline">¶</a></h3>
<p>The most commonly used type of fairshare is priority based fairshare. In
this mode, fairshare information does not affect whether or not a job
can run, but rather only affects the job&#8217;s priority relative to other
jobs. In most cases, this is the desired behavior. Using the standard
fairshare target, the priority of jobs of a particular user which has
used too many resources over the specified fairshare window is lowered.
Also, the standard fairshare target will increase the priority of jobs
which have not received enough resources.</p>
<p>While the standard fairshare target is the most commonly used, Maui also
provides the ability to specify fairshare caps and floors. These targets
are like the default target <strong>only</strong> caps only adjust priority down when
usage is too high and floors <strong>only</strong> adjust priority up when usage is
too low.</p>
<p>Since fairshare usage information must be integrated with with Maui&#8217;s
overall priority mechanism, it is critical that the corresponding
fairshare priority weights be set. Specifically, the
<a class="reference external" href="a.fparameters.html#fsweight">FSWEIGHT</a> component weight parameter
and the target type subcompoent weight (i.e.,
<a class="reference external" href="a.fparameters.html#fsuserweight">FSUSERWEIGHT</a>,
<a class="reference external" href="a.fparameters.html#fsgroupweight">FSGROUPWEIGHT</a>, etc) be specified.
<strong>If these weights are not set, the fairshare mechanism will be enabled
but have no effect on scheduling behavior!</strong> See the <a class="reference external" href="5.1.2priorityfactors.html">Priority Component
Overview</a> for more information on setting
priority weights.</p>
</div>
<div class="section" id="feasibility-based-fairshare">
<h3>6.3.3.2. Feasibility Based Fairshare<a class="headerlink" href="#feasibility-based-fairshare" title="Permalink to this headline">¶</a></h3>
<p>In addition to the standard priority fairshare targets, Maui also allows
a site to specify fairshare <em>caps</em>. A cap is specified as either a hard
absolute number of cycles allowed during the fairshare window or as a
percentage of total cycles delivered. If the fairshare cap is reached or
exceeded, the job is not allowed to run even if there are resources
available.</p>
<p class="rubric" id="see-also">See Also:</p>
<div class="line-block">
<div class="line">The &#8216;<a class="reference external" href="commands/diagnosefairshare.html">diagnose -f</a>&#8216; command was
created to allow diagnosis and monitoring of the fairshare facility.</div>
<div class="line"><strong>`FSENFORCEMENT &lt;a.fparameters.html#fsenforcement&gt;`__</strong></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">6.3. Fairshare</a><ul>
<li><a class="reference internal" href="#overview">6.3.1. Overview</a></li>
<li><a class="reference internal" href="#fairshare-parameters">6.3.2. Fairshare Parameters</a><ul>
<li><a class="reference internal" href="#metric-of-consumption">6.3.2.1. Metric of Consumption</a></li>
<li><a class="reference internal" href="#specifying-fairshare-timeframe">6.3.2.2. Specifying Fairshare Timeframe</a></li>
<li><a class="reference internal" href="#managing-fairshare-data">6.3.2.3. Managing Fairshare Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-fairshare-information">6.3.3. Using Fairshare Information</a><ul>
<li><a class="reference internal" href="#priority-based-fairshare">6.3.3.1. Priority Based Fairshare</a></li>
<li><a class="reference internal" href="#feasibility-based-fairshare">6.3.3.2. Feasibility Based Fairshare</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="6.2throttlingpolicies.html"
                        title="previous chapter">6.2. Throttling Policies</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="6.4allocationmanagement.html"
                        title="next chapter">6.4. Allocation Management</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/6.3fairshare.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="6.4allocationmanagement.html" title="6.4. Allocation Management"
             >next</a> |</li>
        <li class="right" >
          <a href="6.2throttlingpolicies.html" title="6.2. Throttling Policies"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Maui Scheduler™ Administrator&#39;s Guide 3.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="6.0managingfairness.html" >6. Managing Fairness - Throttling Policies, Fairshare, and Allocation Management</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 1999-2014, Adaptive Computing Enterprises, Inc.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.
    </div>
  </body>
</html>